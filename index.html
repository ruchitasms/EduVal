<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Energy Valuation Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .result-card { display: none; margin-top: 20px; }
        .chart-container { position: relative; height:300px; width:100%; margin-top: 20px; }
        .loading { display: none; }
    </style>
</head>
<body>
    <main class="container">
        <hgroup style="margin-top:40px;">
            <h1>Energy Valuation Tracker</h1>
            <p><strong>Method:</strong> Relative Valuation (EV/EBITDA Multiples)</p>
        </hgroup>

        <article>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="ticker" placeholder="Enter Ticker (e.g., XOM)" style="margin-bottom:0;">
                <button onclick="getValuation()">Analyze & Chart</button>
            </div>
            <progress id="loader" class="loading"></progress>
        </article>

        <div id="output" class="result-card">
            <article>
                <header><h3 id="compName">Company Results</h3></header>
                <div class="grid">
                    <div><strong>Enterprise Value (EV)</strong><br><span id="ev"></span></div>
                    <div><strong>EV/EBITDA Multiple</strong><br><span id="multiple"></span></div>
                    <div><strong>Logical Status</strong><br><span id="status"></span></div>
                </div>
                
                <div class="chart-container">
                    <canvas id="valChart"></canvas>
                </div>

                <footer style="margin-top:20px;">
                    <small>
                        <strong>Note on Method:</strong> This tool uses <strong>Relative Valuation</strong>. 
                        It compares the company's total sticker price (EV) against its earnings (EBITDA) 
                        to determine if it's trading at a premium or discount relative to the energy sector.
                    </small>
                </footer>
            </article>
        </div>
    </main>

    <script>
        let myChart = null;

        async function getValuation() {
            const ticker = document.getElementById('ticker').value.toUpperCase();
            const loader = document.getElementById('loader');
            const output = document.getElementById('output');
            
            if(!ticker) return;
            loader.style.display = 'block';
            output.style.display = 'none';

            try {
                const response = await fetch(`https://query1.finance.yahoo.com/v10/finance/quoteSummary/${ticker}?modules=defaultKeyStatistics,financialData,price`);
                const data = await response.json();
                const result = data.quoteSummary.result[0];

                const mktCap = result.price.marketCap.raw;
                const totalDebt = result.financialData.totalDebt.raw || 0;
                const totalCash = result.financialData.totalCash.raw || 0;
                const ebitda = result.financialData.ebitda.raw || 1;

                const ev = mktCap + totalDebt - totalCash;
                const multiple = ev / ebitda;

                // Update Text
                document.getElementById('compName').innerText = result.price.longName;
                document.getElementById('ev').innerText = `$${(ev/1e9).toFixed(2)}B`;
                document.getElementById('multiple').innerText = `${multiple.toFixed(2)}x`;
                
                let status = "Fair Value";
                if(multiple < 6) status = "Undervalued (Value Play)";
                else if(multiple > 12) status = "Growth (Strategic Premium)";
                document.getElementById('status').innerText = status;

                // Update Visual Chart
                updateChart(mktCap, totalDebt, totalCash);
                output.style.display = 'block';
            } catch (e) {
                alert("Error: Data not available for this ticker.");
            } finally {
                loader.style.display = 'none';
            }
        }

        function updateChart(mkt, debt, cash) {
            const ctx = document.getElementById('valChart').getContext('2d');
            if (myChart) { myChart.destroy(); } // Refresh chart if it exists

            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Market Cap', 'Total Debt', 'Cash'],
                    datasets: [{
                        label: 'Billions (USD)',
                        data: [mkt/1e9, debt/1e9, cash/1e9],
                        backgroundColor: ['#3b4d61', '#d35400', '#27ae60']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        }
    </script>
</body>
</html>
