<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Energy Valuation Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --pico-primary: #00a8e8; 
            --pico-background-color: #0b0e14;
            --pico-card-background-color: #151921;
        }
        body { font-family: 'Inter', sans-serif; }
        .chart-container { height: 220px; margin-top: 15px; }
        .metric-val { font-size: 2rem; font-weight: 700; color: var(--pico-primary); }
        .glossary-section { 
            background: #1c222d; 
            padding: 2rem; 
            border-radius: 8px; 
            border-top: 4px solid var(--pico-primary); 
            margin-top: 2rem;
        }
        progress { display: none; }
    </style>
</head>
<body>
    <main class="container">
        <hgroup style="margin-top:2rem;">
            <h1>Energy Valuation Tracker</h1>
            <p>Professional Analytics for Energy Equity Valuation</p>
        </hgroup>

        <article>
            <div style="display: flex; gap: 1rem;">
                <input type="text" id="ticker" placeholder="Enter Ticker (e.g. XOM)" style="margin-bottom:0;">
                <button onclick="getValuation()">Generate Report</button>
            </div>
            <progress id="loader"></progress>
        </article>

        <div id="output" style="display:none;">
            <div class="grid">
                <article>
                    <header><h4 id="compName">Company Name</h4></header>
                    <label>EV/EBITDA (TTM)</label>
                    <div class="metric-val" id="multiple">-</div>
                    <div class="chart-container">
                        <canvas id="ratioChart"></canvas>
                    </div>
                    <footer>
                        <small>Net Debt / EBITDA: <span id="leverage">-</span></small>
                    </footer>
                </article>

                <article>
                    <header><h4>Market Momentum</h4></header>
                    <label>Latest Closing Price</label>
                    <div class="metric-val" id="price">-</div>
                    <div class="chart-container">
                        <canvas id="historyChart"></canvas>
                    </div>
                    <table role="grid" style="margin-top: 1rem; font-size: 0.85rem;">
                        <tbody id="perfStats"></tbody>
                    </table>
                </article>
            </div>

            <section class="glossary-section">
                <h3>Financial Analysis Framework</h3>
                <div class="grid">
                    <div>
                        <strong>Relative Valuation Methodology</strong>
                        <p>This approach values an asset by comparing it to similar assets in the market. By using multiples like EV/EBITDA, analysts can normalize differences in capital structure to determine if a stock is trading at a discount or premium relative to its sector.</p>
                    </div>
                    <div>
                        <strong>Leverage & Solvency</strong>
                        <p>The Net Debt/EBITDA ratio measures a company's ability to pay off its incurred debt. In capital-intensive industries like Energy, maintaining a ratio typically below 3.0x is a key indicator of financial composure and operational stability.</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        let ratioChart = null;
        let historyChart = null;
        const API_KEY = '1YJOf8Lz9qJUlyPUhgKqc3vpzMflW1mx';

        async function getValuation() {
            const ticker = document.getElementById('ticker').value.toUpperCase().trim();
            if (!ticker) return;

            document.getElementById('loader').style.display = 'block';
            document.getElementById('output').style.display = 'none';

            try {
                const [pRes, mRes, hRes] = await Promise.all([
                    fetch(`https://financialmodelingprep.com/stable/profile?symbol=${ticker}&apikey=${API_KEY}`),
                    fetch(`https://financialmodelingprep.com/stable/key-metrics-ttm?symbol=${ticker}&apikey=${API_KEY}`),
                    fetch(`https://financialmodelingprep.com/stable/historical-price-eod/light?symbol=${ticker}&apikey=${API_KEY}`)
                ]);

                const profile = (await pRes.json())[0];
                const metrics = (await mRes.json())[0];
                const historyData = await hRes.json();

                if (!profile || !metrics) throw new Error("Invalid Data");

                // Update Text Elements
                document.getElementById('compName').innerText = profile.companyName;
                document.getElementById('multiple').innerText = metrics.evToEBITDA ? `${metrics.evToEBITDA.toFixed(2)}x` : 'N/A';
                document.getElementById('price').innerText = `$${profile.price.toFixed(2)}`;
                document.getElementById('leverage').innerText = metrics.netDebtToEBITDA ? metrics.netDebtToEBITDA.toFixed(2) : 'N/A';

                document.getElementById('perfStats').innerHTML = `
                    <tr><td>Market Cap</td><td align="right">$${(profile.marketCap / 1e9).toFixed(2)}B</td></tr>
                    <tr><td>52W High</td><td align="right">$${profile.range.split('-')[1]}</td></tr>
                    <tr><td>Beta</td><td align="right">${profile.beta.toFixed(2)}</td></tr>
                `;

                // 1. Ratio Visualization (Doughnut)
                const ctxR = document.getElementById('ratioChart').getContext('2d');
                if (ratioChart) ratioChart.destroy();
                ratioChart = new Chart(ctxR, {
                    type: 'doughnut',
                    data: {
                        labels: ['Equity Value', 'Enterprise Value Contribution'],
                        datasets: [{
                            data: [profile.marketCap, profile.marketCap * 0.25],
                            backgroundColor: ['#00a8e8', '#2a313d'],
                            borderWidth: 0
                        }]
                    },
                    options: { maintainAspectRatio: false, cutout: '80%' }
                });

                // 2. 7-Day History Movement (Line)
                const ctxH = document.getElementById('historyChart').getContext('2d');
                if (historyChart) historyChart.destroy();
                
                const week = (historyData.historical || []).slice(0, 7).reverse();
                
                historyChart = new Chart(ctxH, {
                    type: 'line',
                    data: {
                        labels: week.map(d => d.date.substring(5)),
                        datasets: [{
                            data: week.map(d => d.close),
                            borderColor: '#00a8e8',
                            backgroundColor: 'rgba(0, 168, 232, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: { 
                        maintainAspectRatio: false, 
                        plugins: { legend: { display: false } },
                        scales: { x: { grid: { display: false } }, y: { grid: { color: '#2a313d' } } }
                    }
                });

                document.getElementById('output').style.display = 'block';
            } catch (e) {
                alert("Technical Error: Verify ticker and connection.");
                console.error(e);
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }
    </script>
</body>
</html>
