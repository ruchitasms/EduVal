<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Global Equity Pulse</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --pico-primary: #00d4ff; --pico-background-color: #0d1117; --pico-card-background-color: #161b22; }
        .metric-val { font-size: 2.4rem; font-weight: 800; color: var(--pico-primary); line-height: 1; }
        .ticker-btn { padding: 4px 12px; font-size: 0.75rem; margin-right: 5px; cursor: pointer; border-radius: 20px; }
        .chart-container { height: 280px; }
        progress { display: none; }
        .solvency-indicator { font-weight: bold; border-radius: 4px; padding: 2px 6px; }
    </style>
</head>
<body>
    <main class="container">
        <hgroup style="margin-top:2rem;">
            <h1>Global Equity Pulse</h1>
            <p>Institutional-Grade Multi-Sector Analysis</p>
        </hgroup>

        <article style="padding: 1rem;">
            <div id="quickSelect" style="margin-bottom: 1rem;">
                <small>Quick Select:</small><br>
                <button class="ticker-btn outline" onclick="runAnalysis('XOM')">XOM</button>
                <button class="ticker-btn outline" onclick="runAnalysis('NFLX')">NFLX</button>
                <button class="ticker-btn outline" onclick="runAnalysis('NVDA')">NVDA</button>
                <button class="ticker-btn outline" onclick="runAnalysis('MSFT')">MSFT</button>
                <button class="ticker-btn outline" onclick="runAnalysis('GOOGL')">GOOGL</button>
                <button class="ticker-btn outline" onclick="runAnalysis('CVX')">CVX</button>
                <button class="ticker-btn outline" onclick="runAnalysis('TSLA')">TSLA</button>
                <button class="ticker-btn outline" onclick="runAnalysis('DIS')">DIS</button>
                <button class="ticker-btn outline" onclick="runAnalysis('INTC')">INTC</button>
                <button class="ticker-btn outline" onclick="runAnalysis('SOFI')">SOFI</button>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="tickerInput" placeholder="Enter Ticker..." style="margin-bottom:0;">
                <button onclick="runAnalysis(document.getElementById('tickerInput').value)">Analyze</button>
            </div>
            <progress id="loader"></progress>
        </article>

        <div id="dashboard" style="display:none;">
            <div class="grid">
                <article>
                    <header><h4 id="compName">---</h4></header>
                    <label>Enterprise Multiple (EV/EBITDA)</label>
                    <div class="metric-val" id="evEbitdaDisplay">-</div>
                    <hr>
                    <table role="grid">
                        <tr>
                            <td>Net Debt / EBITDA</td>
                            <td align="right"><span id="leverageVal" class="solvency-indicator">-</span></td>
                        </tr>
                        <tr>
                            <td>Enterprise Value</td>
                            <td align="right" id="evVal">-</td>
                        </tr>
                    </table>
                    <footer>
                        <small>A debt-neutral valuation metric used to compare companies across different capital structures.</small>
                    </footer>
                </article>

                <article>
                    <header><h4>7-Day Price Momentum</h4></header>
                    <div class="chart-container">
                        <canvas id="priceChart"></canvas>
                    </div>
                    <table role="grid" style="margin-top: 10px;">
                        <tr>
                            <td>Current Market Cap</td>
                            <td align="right" id="mktCapVal">-</td>
                        </tr>
                    </table>
                </article>
            </div>
        </div>
    </main>

    <script>
        let priceChart = null;
        const API_KEY = '1YJOf8Lz9qJUlyPUhgKqc3vpzMflW1mx';

        async function runAnalysis(ticker) {
            ticker = ticker.toUpperCase().trim();
            if(!ticker) return;

            document.getElementById('loader').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';

            try {
                const [pRes, mRes, hRes] = await Promise.all([
                    fetch(`https://financialmodelingprep.com/stable/profile?symbol=${ticker}&apikey=${API_KEY}`),
                    fetch(`https://financialmodelingprep.com/stable/key-metrics?symbol=${ticker}&apikey=${API_KEY}`),
                    fetch(`https://financialmodelingprep.com/stable/historical-price-eod/light?symbol=${ticker}&apikey=${API_KEY}`)
                ]);

                const pData = await pRes.json();
                const mData = await mRes.json();
                const hData = await hRes.json();

                // Normalization Logic
                const profile = Array.isArray(pData) ? pData[0] : pData;
                const metrics = Array.isArray(mData) ? mData[0] : mData;
                const historyRaw = Array.isArray(hData) ? hData : (hData.historical || []);

                if (!profile || !metrics) throw new Error("Data Unavailable");

                // Update UI
                document.getElementById('compName').innerText = profile.companyName;
                document.getElementById('evEbitdaDisplay').innerText = metrics.evToEBITDA ? `${metrics.evToEBITDA.toFixed(1)}x` : 'N/A';
                
                const lev = metrics.netDebtToEBITDA;
                const levEl = document.getElementById('leverageVal');
                levEl.innerText = lev ? `${lev.toFixed(2)}x` : 'N/A';
                levEl.style.backgroundColor = lev > 3.5 ? 'rgba(255, 77, 77, 0.2)' : 'rgba(0, 212, 255, 0.1)';
                levEl.style.color = lev > 3.5 ? '#ff4d4d' : '#00d4ff';

                document.getElementById('evVal').innerText = `$${(metrics.enterpriseValue / 1e9).toFixed(1)}B`;
                document.getElementById('mktCapVal').innerText = `$${(profile.marketCap / 1e9).toFixed(1)}B`;

                // Charting
                const ctx = document.getElementById('priceChart').getContext('2d');
                if (priceChart) priceChart.destroy();
                const week = historyRaw.slice(0, 7).reverse();
                
                priceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: week.map(d => d.date.split('-').slice(1).join('/')),
                        datasets: [{
                            data: week.map(d => d.price),
                            borderColor: '#00d4ff',
                            borderWidth: 3,
                            fill: true,
                            backgroundColor: 'rgba(0, 212, 255, 0.05)',
                            tension: 0.4,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { x: { grid: { display: false } }, y: { grid: { color: '#1f2937' } } }
                    }
                });

                document.getElementById('dashboard').style.display = 'block';
            } catch (e) {
                alert("Technical Error: Ensure the API key and Ticker are valid.");
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }
    </script>
</body>
</html>
