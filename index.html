<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Global Equity Pulse</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --pico-primary: #00a8e8; 
            --pico-background-color: #0b0e14;
            --pico-card-background-color: #151921;
            --pico-spacing: 0.75rem; /* Tightens overall spacing */
        }
        body { padding-top: 10px; }
        .chart-container { height: 260px; }
        .metric-val { font-size: 2.2rem; font-weight: 700; color: var(--pico-primary); }
        .glossary-section { background: #1c222d; padding: 1.2rem; border-radius: 8px; border-top: 4px solid var(--pico-primary); margin-top: 1rem; }
        article { margin-bottom: 1rem !important; padding: 1rem !important; }
        progress { display: none; margin: 10px 0; }
        .sub-header { color: #888; font-size: 0.9rem; margin-top: -10px; display: block; }
        h1 { margin-bottom: 0.2rem; }
    </style>
</head>
<body>
    <main class="container">
        <header style="margin-bottom: 1rem;">
            <h1>Global Equity Pulse</h1>
            <p style="margin-bottom:0.5rem;">Professional Multi-Sector Fundamental Analysis</p>
            
            <label for="tickerSelect" style="font-weight:bold;">Select a Company to Analyze:</label>
            <select id="tickerSelect" onchange="runAnalysis(this.value)" style="margin-bottom:0;">
                <option value="" disabled selected>Select from Featured Tickers...</option>
                <option value="XOM">ExxonMobil (Energy)</option>
                <option value="CVX">Chevron (Energy)</option>
                <option value="NVDA">NVIDIA (Semiconductors)</option>
                <option value="MSFT">Microsoft (Software)</option>
                <option value="GOOGL">Alphabet (Tech)</option>
                <option value="NFLX">Netflix (Entertainment)</option>
                <option value="TSLA">Tesla (Automotive/Energy)</option>
                <option value="DIS">Disney (Entertainment)</option>
                <option value="INTC">Intel (Semiconductors)</option>
                <option value="SOFI">SoFi (Fintech)</option>
            </select>
            <progress id="loader"></progress>
        </header>

        <div id="dashboard" style="display:none;">
            <div class="grid">
                <article>
                    <header>
                        <h4 id="compName" style="margin-bottom:0;">Company Name</h4>
                        <span id="industryLabel" class="sub-header">Industry | TICKER</span>
                    </header>
                    <label>EV / EBITDA (Latest Fiscal)</label>
                    <div class="metric-val" id="evEbitdaDisplay">-</div>
                    
                    <table role="grid" style="margin-top:0.5rem; margin-bottom:0;">
                        <tbody>
                            <tr>
                                <td>Net Debt / EBITDA</td>
                                <td align="right"><span id="leverageVal" style="font-weight:bold;">-</span></td>
                            </tr>
                            <tr>
                                <td>Enterprise Value</td>
                                <td align="right" id="evVal">-</td>
                            </tr>
                            <tr>
                                <td>Market Cap</td>
                                <td align="right" id="mktCapVal">-</td>
                            </tr>
                        </tbody>
                    </table>
                </article>

                <article>
                    <header><strong>7-Day Price Movement</strong></header>
                    <div class="chart-container">
                        <canvas id="priceChart"></canvas>
                    </div>
                    <footer style="padding: 0.5rem 0;">
                        <small id="priceDisplay" style="font-weight:bold; color:var(--pico-primary);"></small>
                        <small id="dataDate" style="float:right;">FY: ---</small>
                    </footer>
                </article>
            </div>

            <section class="glossary-section">
                <div class="grid" style="--pico-grid-spacing-horizontal: 2rem;">
                    <div>
                        <strong>EV/EBITDA</strong>
                        <p style="font-size:0.85rem; margin-bottom:0;">The "Acquisition Multiple." It measures the cost of a company's cash flow regardless of debt structure.</p>
                    </div>
                    <div>
                        <strong>Net Debt/EBITDA</strong>
                        <p style="font-size:0.85rem; margin-bottom:0;">The "Solvency Check." Shows how many years of profit are needed to pay off total debt.</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        let priceChart = null;
        const API_KEY = '1YJOf8Lz9qJUlyPUhgKqc3vpzMflW1mx';

        // Helper to get Industry from the select text
        function getIndustryFromUI(ticker) {
            const select = document.getElementById('tickerSelect');
            const option = Array.from(select.options).find(opt => opt.value === ticker);
            if (option) {
                const match = option.text.match(/\(([^)]+)\)/);
                return match ? match[1] : 'General';
            }
            return 'General';
        }

        async function runAnalysis(ticker) {
            if (!ticker) return;
            document.getElementById('loader').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';

            try {
                const [pRes, mRes, hRes] = await Promise.all([
                    fetch(`https://financialmodelingprep.com/stable/profile?symbol=${ticker}&apikey=${API_KEY}`),
                    fetch(`https://financialmodelingprep.com/stable/key-metrics?symbol=${ticker}&apikey=${API_KEY}`),
                    fetch(`https://financialmodelingprep.com/stable/historical-price-eod/light?symbol=${ticker}&apikey=${API_KEY}`)
                ]);

                const pData = await pRes.json();
                const mData = await mRes.json();
                const hData = await hRes.json();

                const profile = Array.isArray(pData) ? pData[0] : pData;
                const metrics = Array.isArray(mData) ? mData[0] : mData;
                const historyRaw = Array.isArray(hData) ? hData : (hData.historical || []);

                if (!profile || !metrics) throw new Error("Data Error");

                // Header Info
                document.getElementById('compName').innerText = profile.companyName;
                document.getElementById('industryLabel').innerText = `${getIndustryFromUI(ticker)} | ${ticker}`;
                document.getElementById('dataDate').innerText = `Fiscal Year: ${metrics.fiscalYear || 'N/A'}`;
                
                // Metrics
                document.getElementById('evEbitdaDisplay').innerText = metrics.evToEBITDA ? `${metrics.evToEBITDA.toFixed(2)}x` : 'N/A';
                const lev = metrics.netDebtToEBITDA;
                const levEl = document.getElementById('leverageVal');
                levEl.innerText = lev ? `${lev.toFixed(2)}x` : 'N/A';
                levEl.style.color = lev > 3 ? '#ff4d4d' : '#00e676';

                document.getElementById('evVal').innerText = `$${(metrics.enterpriseValue / 1e9).toFixed(2)}B`;
                document.getElementById('mktCapVal').innerText = `$${(profile.marketCap / 1e9).toFixed(2)}B`;
                document.getElementById('priceDisplay').innerText = `Latest Price: $${profile.price.toFixed(2)}`;

                // Charting
                const ctx = document.getElementById('priceChart').getContext('2d');
                if (priceChart) priceChart.destroy();
                const week = historyRaw.slice(0, 7).reverse();
                
                priceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: week.map(d => d.date.substring(5).replace('-', '/')),
                        datasets: [{
                            data: week.map(d => d.price),
                            borderColor: '#00a8e8',
                            backgroundColor: 'rgba(0, 168, 232, 0.1)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4
                        }]
                    },
                    options: { 
                        maintainAspectRatio: false, 
                        plugins: { legend: { display: false } },
                        scales: { x: { grid: { display: false } }, y: { grid: { color: '#2a313d' } } }
                    }
                });

                document.getElementById('dashboard').style.display = 'block';
            } catch (e) {
                alert("Technical error loading data.");
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }
    </script>
</body>
</html>
