<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Valuation Dashboard</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <style>
        /* This prevents the code from appearing as text before the page loads */
        script[type="py"] { display: none; }
        .loading { padding: 20px; text-align: center; }
    </style>
</head>
<body>
    <main class="container">
        <hgroup style="margin-top: 40px;">
            <h1>Energy Valuation Tracker</h1>
            <p>A Data-Driven Approach to Enterprise Value (EV)</p>
        </hgroup>

        <article>
            <label for="ticker">Enter Energy Ticker (e.g., XOM, CVX, NEE)</label>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="ticker" placeholder="XOM" style="margin-bottom: 0;">
                <button id="analyze-btn" py-click="calculate_valuation">Analyze</button>
            </div>
        </article>

        <section id="output-section" style="display:none;">
            <article>
                <header><strong id="company-name">Analyzing...</strong></header>
                <div id="results"></div>
                <hr>
                <p><strong>Strategic Insight:</strong> <span id="logic-check">...</span></p>
            </article>
        </section>

        <div id="loading-msg" class="loading">
            <small>Initializing Python Environment...</small>
        </div>

        <py-config>
            packages = ["yfinance", "pandas"]
        </py-config>

        <script type="py">
import yfinance as yf
from pyscript import display, document

# Hide loading message once python is ready
document.getElementById("loading-msg").style.display = "none"

def calculate_valuation(event):
    ticker_input = document.getElementById("ticker").value.upper()
    if not ticker_input:
        return

    # Fetch Data
    try:
        stock = yf.Ticker(ticker_input)
        info = stock.info
        
        name = info.get('longName', 'Unknown Entity')
        ebitda = info.get('ebitda', 1)
        mkt_cap = info.get('marketCap', 0)
        debt = info.get('totalDebt', 0)
        cash = info.get('totalCash', 0)
        
        # The Logic: Enterprise Value (EV)
        ev = mkt_cap + debt - cash
        multiple = ev / ebitda if ebitda != 0 else 0
        
        # Update UI
        document.getElementById("output-section").style.display = "block"
        document.getElementById("company-name").innerText = name
        
        res_html = f"""
        <div class='grid'>
            <div><strong>EV:</strong><br>${ev/1e9:.2f}B</div>
            <div><strong>EV/EBITDA:</strong><br>{multiple:.2f}x</div>
            <div><strong>Cash:</strong><br>${cash/1e9:.2f}B</div>
        </div>
        """
        document.getElementById("results").innerHTML = res_html
        
        # Leadership Logic Check
        status = "Fair Value"
        if multiple < 6: status = "Potentially Undervalued: Strong 'Buy' candidate for logical investigation."
        elif multiple > 12: status = "Growth Premium: Market is pricing in a vibrant future transition."
        
        document.getElementById("logic-check").innerText = status
        
    except Exception as e:
        document.getElementById("logic-check").innerText = "Error fetching data. Check ticker symbol."
        </script>
    </main>
</body>
</html>
