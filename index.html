<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Energy Valuation Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --pico-primary: #5da9e9; --pico-card-background-color: #1a212c; }
        body { background-color: #0f141a; color: #e1e4e8; }
        .chart-box { height: 280px; margin-bottom: 20px; background: #1a212c; border: 1px solid #2d3748; border-radius: 12px; padding: 15px; }
        .glossary { background: #1a212c; padding: 25px; border-radius: 12px; margin-top: 30px; border-left: 6px solid #5da9e9; }
        .metric-val { font-size: 2.2rem; font-weight: 800; color: #5da9e9; text-shadow: 0 0 10px rgba(93, 169, 233, 0.3); }
        article { background: #1a212c !important; border: 1px solid #2d3748; }
        progress { display: none; }
    </style>
</head>
<body>
    <main class="container">
        <hgroup style="margin-top:40px;">
            <h1 style="color: #5da9e9;">Energy Valuation Tracker</h1>
            <p>Vibrant Metrics. Mythic Compose. Dark Precision.</p>
        </hgroup>

        <article>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="ticker" placeholder="XOM, CVX, BP..." style="margin-bottom:0; background: #0f141a;">
                <button onclick="getValuation()">Analyze Ticker</button>
            </div>
            <progress id="loader"></progress>
        </article>

        <div id="output" style="display:none;">
            <div class="grid">
                <article>
                    <header><h4 id="displayTicker" style="color: #fff;">---</h4></header>
                    <p>EV / EBITDA (TTM)</p>
                    <div class="metric-val" id="multiple">-</div>
                    <p style="margin-top:10px; font-size: 0.9rem;">Leverage: <span id="leverageText" style="color:#e9967a;">--</span> (Net Debt/EBITDA)</p>
                    <div class="chart-box">
                        <canvas id="gaugeChart"></canvas>
                    </div>
                </article>

                <article>
                    <header><h4 style="color: #fff;">7-Day Price Trend</h4></header>
                    <p>Momentum Context</p>
                    <div class="metric-val" id="lastPrice">-</div>
                    <div class="chart-box">
                        <canvas id="historyChart"></canvas>
                    </div>
                </article>
            </div>

            <section class="glossary">
                <h3 style="color: #5da9e9;">Metric Insights</h3>
                <div class="grid">
                    <div>
                        <strong>Relative Valuation</strong>
                        <p>A "mythic" comparison to peers. If this companyâ€™s EV/EBITDA is lower than its industry neighbors, it may represent a value opportunity hiding in plain sight.</p>
                    </div>
                    <div>
                        <strong>Net Debt to EBITDA</strong>
                        <p>This "Vitality Ratio" measures solvency. It tells us how many years of current EBITDA it would take to pay back all debt. Lower is safer, showing higher composure.</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        // Global Chart Defaults for Dark Mode
        Chart.defaults.color = '#a0aec0';
        Chart.defaults.borderColor = '#2d3748';
        let mainChart = null, historyChart = null;

        const KEY = '1YJOf8Lz9qJUlyPUhgKqc3vpzMflW1mx';

        async function getValuation() {
            const sym = document.getElementById('ticker').value.toUpperCase().trim();
            if(!sym) return;

            document.getElementById('loader').style.display = 'block';
            document.getElementById('output').style.display = 'none';

            try {
                const [pRes, mRes, hRes] = await Promise.all([
                    fetch(`https://financialmodelingprep.com/stable/profile?symbol=${sym}&apikey=${KEY}`),
                    fetch(`https://financialmodelingprep.com/stable/key-metrics-ttm?symbol=${sym}&apikey=${KEY}`),
                    fetch(`https://financialmodelingprep.com/stable/historical-price-eod/light?symbol=${sym}&apikey=${KEY}`)
                ]);

                const p = (await pRes.json())[0];
                const m = (await mRes.json())[0];
                const h = await hRes.json();

                if (!p || !m) throw new Error("Missing Data");

                // 1. Text Data Injection
                document.getElementById('displayTicker').innerText = p.companyName;
                document.getElementById('lastPrice').innerText = `$${p.price.toFixed(2)}`;
                
                const evEbitda = m.evToEBITDA;
                document.getElementById('multiple').innerText = evEbitda ? `${evEbitda.toFixed(2)}x` : "N/A";
                
                const leverage = m.netDebtToEBITDA || 0;
                document.getElementById('leverageText').innerText = leverage.toFixed(2);

                // 2. Market Cap Visualization (Doughnut)
                const ctxG = document.getElementById('gaugeChart').getContext('2d');
                if(mainChart) mainChart.destroy();
                mainChart = new Chart(ctxG, {
                    type: 'doughnut',
                    data: {
                        labels: ['Equity Value', 'Enterprise Value Contribution'],
                        datasets: [{
                            data: [p.marketCap, p.marketCap * 0.2], // Visual proxy for structure
                            backgroundColor: ['#5da9e9', '#2d3748'],
                            borderWidth: 0
                        }]
                    },
                    options: { maintainAspectRatio: false, cutout: '70%' }
                });

                // 3. 7-Day Trend Line Chart
                const ctxH = document.getElementById('historyChart').getContext('2d');
                if(historyChart) historyChart.destroy();
                
                const weekData = h.historical ? h.historical.slice(0, 7).reverse() : [];
                
                historyChart = new Chart(ctxH, {
                    type: 'line',
                    data: {
                        labels: weekData.map(d => d.date.substring(5)), // MM-DD
                        datasets: [{
                            label: 'Closing Price',
                            data: weekData.map(d => d.close),
                            borderColor: '#5da9e9',
                            backgroundColor: 'rgba(93, 169, 233, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 5,
                            pointHoverRadius: 8
                        }]
                    },
                    options: { 
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: false, grid: { color: '#2d3748' } }, x: { grid: { display: false } } }
                    }
                });

                document.getElementById('output').style.display = 'block';
            } catch (err) {
                alert("Data Error: " + err.message);
                console.error(err);
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }
    </script>
</body>
</html>
