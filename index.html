<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>EduVal - Financial Literacy Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --pico-primary: #00a8e8; --pico-background-color: #0b0e14; --pico-card-background-color: #151921; }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 1rem; }
        .nav-tabs button { flex: 1; font-size: 0.8rem; padding: 10px; }
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .sts-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        
        /* DIAGNOSTIC LAYOUT */
        #view-diag { display: flex; gap: 1.5rem; align-items: stretch; }
        .diag-sidebar { flex: 0.8; margin: 0; }
        .diag-visual-stack { flex: 1.2; display: flex; flex-direction: column; gap: 1rem; }
        .diag-header-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .mini-diag-card { padding: 10px; border-radius: 8px; font-weight: bold; text-align: center; font-size: 0.8rem; border: 1px solid rgba(255,255,255,0.1); }
        .main-visual-pane { flex: 1; background: var(--pico-card-background-color); border-radius: 8px; padding: 1.2rem; display: flex; flex-direction: column; border-top: 3px solid var(--pico-primary); }
        
        .sts-card { background: var(--pico-card-background-color); padding: 1.2rem; border-radius: 8px; border-top: 3px solid var(--pico-primary); height: 100%; }
        .metric-row { display: flex; justify-content: space-between; border-bottom: 1px solid #2a313d; padding: 8px 0; font-size: 0.85rem; }
        .total-row { border-top: 1px dashed var(--pico-primary); margin-top: 5px; font-weight: bold; color: var(--pico-primary); }
        .chart-wrapper { height: 230px; width: 100%; position: relative; }
        .section-sub { font-size: 0.75rem; color: #888; margin-bottom: 10px; display: block; }
        .fy-anchor { font-weight: bold; color: var(--pico-primary); font-size: 0.85rem; background: #1c222d; padding: 2px 8px; border-radius: 4px; }
        progress { display: none; margin: 10px 0; }
        
        #risk-verdict-box { padding: 1rem; border-radius: 6px; font-size: 0.82rem; line-height: 1.4; border-left: 4px solid var(--pico-primary); background: #1a2029; margin-top: 1rem; }
    </style>
</head>
<body>
    <main class="container">
        <h2>EduVal - Let's learn Finance Together! ðŸ¦‰</h2>
        <header>
            <select id="tickerSelect" onchange="runAnalysis(this.value)">
                <option value="" disabled selected>Select Company to Start Analysis...</option>
                <option value="XOM">ExxonMobil (Energy)</option>
                <option value="CVX">Chevron (Energy)</option>
                <option value="NVDA">NVIDIA (Semiconductors)</option>
                <option value="MSFT">Microsoft (Software)</option>
                <option value="GOOGL">Alphabet (Tech)</option>
                <option value="NFLX">Netflix (Entertainment)</option>
                <option value="TSLA">Tesla (Automotive)</option>
                <option value="DIS">Disney (Entertainment)</option>
                <option value="INTC">Intel (Semiconductors)</option>
                <option value="SOFI">SoFi (Fintech)</option>
            </select>
            <progress id="loader"></progress>
        </header>

        <div id="mainUI" style="display:none;">
            <div class="nav-tabs">
                <button id="btn-val" onclick="switchTab('val')">Valuation</button>
                <button id="btn-sts" onclick="switchTab('sts')">Statements</button>
                <button id="btn-diag" onclick="switchTab('diag')">Risk Diagnostics</button>
            </div>

            <details id="lessonBox" style="background: #1c222d; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <summary>Formulas & Rules of Thumb</summary>
                <div id="lessonContent" style="font-size: 0.85rem; margin-top: 10px; line-height: 1.6;"></div>
            </details>

            <div id="view-val" class="dashboard-grid">
                <article class="sts-card">
                    <header style="border-bottom:none; padding:0; margin-bottom:1rem;">
                        <h4 id="compName" style="margin:0;">-</h4>
                        <small id="industryLabel" style="color:#888;">-</small>
                    </header>
                    <label>EV / EBITDA Multiple</label>
                    <h1 id="evEbitdaDisplay" style="color: var(--pico-primary); margin:0;">-</h1>
                    <div style="margin-top:1.5rem;">
                        <div class="metric-row"><span>Net Debt / EBITDA</span><span id="leverageVal">-</span></div>
                        <div class="metric-row"><span>52-Week Range</span><span id="range52">-</span></div>
                        <div class="metric-row"><span>Enterprise Value</span><span id="evVal">-</span></div>
                    </div>
                    <footer style="margin-top:1rem;"><span class="fy-anchor" id="val-fy">-</span></footer>
                </article>
                <article class="sts-card">
                    <header style="display: flex; justify-content: space-between; align-items: flex-start; border-bottom:none; padding:0;">
                        <strong>7-Day Momentum (2026)</strong>
                        <div style="text-align: right;">
                            <span id="priceDisplay" style="color:var(--pico-primary); font-weight:bold; font-size:1.1rem;">-</span><br>
                            <small id="mktCapVal" style="color:#888;">-</small>
                        </div>
                    </header>
                    <div class="chart-wrapper"><canvas id="priceChart"></canvas></div>
                </article>
            </div>

            <div id="view-sts" style="display:none;">
                <div style="margin-bottom: 10px;"><span class="fy-anchor" id="sts-fy">Fiscal Year: -</span></div>
                <div class="sts-grid">
                    <div class="sts-card">
                        <h6>Balance Sheet</h6>
                        <span class="section-sub">Company's Net Worth</span>
                        <div class="metric-row"><span>Current Ratio</span><span id="currRatioVal">-</span></div>
                        <div class="metric-row"><span>Quick Ratio</span><span id="quickRatioVal">-</span></div>
                        <div class="metric-row"><span>Total Assets</span><span id="assetsVal">-</span></div>
                        <div class="metric-row"><span>Total Liab.</span><span id="liabVal">-</span></div>
                        <div class="metric-row total-row"><span>Enterprise Value</span><span id="evValSts">-</span></div>
                    </div>
                    <div class="sts-card">
                        <h6>Income Statement</h6>
                        <span class="section-sub">Company's Profitability</span>
                        <div class="metric-row"><span>Net Margin</span><span id="netMarginVal">-</span></div>
                        <div class="metric-row"><span>EPS Growth</span><span id="epsGrowthVal">-</span></div>
                        <div class="metric-row"><span>Revenue</span><span id="revVal">-</span></div>
                        <div class="metric-row"><span>Net Income</span><span id="netIncVal">-</span></div>
                        <div class="metric-row total-row"><span>EBITDA</span><span id="ebitdaValSts">-</span></div>
                    </div>
                    <div class="sts-card">
                        <h6>Cash Flow</h6>
                        <span class="section-sub">Company's Cash Generation</span>
                        <div class="metric-row"><span>Cash Conversion</span><span id="cashConvVal">-</span></div>
                        <div class="metric-row"><span>Working Cap</span><span id="workCapVal">-</span></div>
                        <div class="metric-row"><span>Operating CF</span><span id="ocfVal">-</span></div>
                        <div class="metric-row total-row" style="color:var(--pico-primary)"><span>Free Cash Flow</span><span id="fcfVal">-</span></div>
                    </div>
                </div>
            </div>

            <div id="view-diag" style="display:none;">
                <article class="sts-card diag-sidebar">
                    <h6 style="color: var(--pico-primary);">Structural Health</h6>
                    <div class="metric-row"><span>Operating Cycle (Days)</span><span id="d-oc">-</span></div>
                    <div class="metric-row"><span>Debt to Equity Ratio</span><span id="d-de">-</span></div>
                    <div class="metric-row"><span>Interest Coverage</span><span id="d-ic">-</span></div>
                    <div class="metric-row"><span>Financial Leverage</span><span id="d-fl">-</span></div>
                    <div class="metric-row"><span>Cash Ratio</span><span id="d-cashr">-</span></div>
                    <div class="metric-row"><span>Solvency Ratio</span><span id="d-solv">-</span></div>
                    <br>
                    <h6 style="color: var(--pico-primary);">Market Context</h6>
                    <div class="metric-row"><span>Dividend Yield %</span><span id="d-dy">-</span></div>
                    <div class="metric-row"><span>Price to Earnings (P/E)</span><span id="d-pe">-</span></div>
                </article>

                <div class="diag-visual-stack">
                    <div class="diag-header-row">
                        <div id="d-cr-box" class="mini-diag-card">-</div>
                        <div id="d-nm-box" class="mini-diag-card">-</div>
                        <div id="d-cc-box" class="mini-diag-card">-</div>
                    </div>
                    <div class="main-visual-pane">
                        <div style="text-align: center;">
                            <h6 style="margin-bottom: 5px; font-size:0.9rem;">Liquidity Composition (Current Assets)</h6>
                            <div class="chart-wrapper" style="height:180px;"><canvas id="assetChart"></canvas></div>
                        </div>
                        <div id="risk-verdict-box">
                            <strong style="color: var(--pico-primary); font-size: 0.9rem;">Business Model & Risks:</strong>
                            <hr style="margin: 8px 0; opacity: 0.1;">
                            <div id="verdictText">Select a ticker...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let priceChart = null;
        let assetChart = null;
        const API_KEY = '1YJOf8Lz9qJUlyPUhgKqc3vpzMflW1mx';
        const sectorThemes = { 'Energy': '#00e676', 'Semiconductors': '#ff9100', 'Software': '#00d4ff', 'Tech': '#a29bfe', 'Entertainment': '#ff4081', 'Automotive': '#ffffff', 'Fintech': '#ffcc00' };

        const learnings = {
            val: `<strong>Valuation Intro</strong><br>â€¢ EV/EBITDA shows cost relative to operations. <10x is Value, >25x is Growth.`,
            sts: `<strong>Statements</strong><br>â€¢ CR: Liquidity cushion (>1.2).<br>â€¢ Net Margin: Profit per $1 (>15%).<br>â€¢ Cash Conv: Profit quality (â‰¥1.0).`,
            diag: `<strong>Diagnostics</strong><br>â€¢ Operating Cycle: Days to cash.<br>â€¢ Interest Coverage: Survival buffer.<br>â€¢ Asset Mix: Checks for liquidity traps.`
        };

        function switchTab(tabId) {
            document.getElementById('view-val').style.display = tabId === 'val' ? 'grid' : 'none';
            document.getElementById('view-sts').style.display = tabId === 'sts' ? 'grid' : 'none';
            document.getElementById('view-diag').style.display = tabId === 'diag' ? 'flex' : 'none';
            document.getElementById('lessonContent').innerHTML = learnings[tabId];
            ['val', 'sts', 'diag'].forEach(id => document.getElementById(`btn-${id}`).classList.toggle('secondary', tabId !== id));
        }

        async function runAnalysis(ticker) {
            document.getElementById('loader').style.display = 'block';
            try {
                const [p, m, h, inc, bs, cf, r] = await Promise.all([
                    fetch(`https://financialmodelingprep.com/stable/profile?symbol=${ticker}&apikey=${API_KEY}`).then(r => r.json()),
                    fetch(`https://financialmodelingprep.com/stable/key-metrics?symbol=${ticker}&apikey=${API_KEY}`).then(r => r.json()),
                    fetch(`https://financialmodelingprep.com/stable/historical-price-eod/light?symbol=${ticker}&apikey=${API_KEY}`).then(r => r.json()),
                    fetch(`https://financialmodelingprep.com/stable/income-statement?symbol=${ticker}&limit=1&apikey=${API_KEY}`).then(r => r.json()),
                    fetch(`https://financialmodelingprep.com/stable/balance-sheet-statement?symbol=${ticker}&limit=1&apikey=${API_KEY}`).then(r => r.json()),
                    fetch(`https://financialmodelingprep.com/stable/cash-flow-statement?symbol=${ticker}&limit=1&apikey=${API_KEY}`).then(r => r.json()),
                    fetch(`https://financialmodelingprep.com/stable/ratios?symbol=${ticker}&limit=1&apikey=${API_KEY}`).then(r => r.json())
                ]);

                const industry = document.getElementById('tickerSelect').selectedOptions[0].text.match(/\(([^)]+)\)/)[1];
                const themeColor = sectorThemes[industry] || '#00a8e8';
                document.documentElement.style.setProperty('--pico-primary', themeColor);

                // 1. Valuation Map
                document.getElementById('compName').innerText = p[0].companyName;
                document.getElementById('industryLabel').innerText = `${industry} | ${ticker}`;
                document.getElementById('priceDisplay').innerText = `Price: $${p[0].price.toFixed(2)}`;
                document.getElementById('mktCapVal').innerText = `Cap: $${(p[0].mktCap / 1e9).toFixed(1)}B`;
                document.getElementById('range52').innerText = p[0].range;
                document.getElementById('evEbitdaDisplay').innerText = m[0].evToEBITDA.toFixed(2) + 'x';
                document.getElementById('evVal').innerText = `$${(m[0].enterpriseValue / 1e9).toFixed(1)}B`;
                document.getElementById('leverageVal').innerText = m[0].netDebtToEBITDA ? m[0].netDebtToEBITDA.toFixed(2) + 'x' : 'N/A';
                document.getElementById('val-fy').innerText = `Audited: FY ${bs[0].calendarYear}`;

                // 2. Statements Map
                document.getElementById('sts-fy').innerText = `Fiscal Year: ${bs[0].calendarYear}`;
                document.getElementById('currRatioVal').innerText = (bs[0].totalCurrentAssets / bs[0].totalCurrentLiabilities).toFixed(2);
                document.getElementById('quickRatioVal').innerText = ((bs[0].cashAndCashEquivalents + bs[0].netReceivables) / bs[0].totalCurrentLiabilities).toFixed(2);
                document.getElementById('assetsVal').innerText = `$${(bs[0].totalAssets / 1e9).toFixed(1)}B`;
                document.getElementById('liabVal').innerText = `$${(bs[0].totalLiabilities / 1e9).toFixed(1)}B`;
                document.getElementById('evValSts').innerText = `$${(m[0].enterpriseValue / 1e9).toFixed(1)}B`;
                document.getElementById('netMarginVal').innerText = ((inc[0].netIncome / inc[0].revenue) * 100).toFixed(1) + '%';
                document.getElementById('epsGrowthVal').innerText = (inc[0].eps ? (inc[0].eps * 10).toFixed(1) : "0.0") + "%"; // Mock growth
                document.getElementById('revVal').innerText = `$${(inc[0].revenue / 1e9).toFixed(1)}B`;
                document.getElementById('netIncVal').innerText = `$${(inc[0].netIncome / 1e9).toFixed(1)}B`;
                document.getElementById('ebitdaValSts').innerText = `$${(inc[0].ebitda / 1e9).toFixed(1)}B`;
                const convVal = (cf[0].operatingCashFlow - cf[0].capitalExpenditure) / inc[0].netIncome;
                document.getElementById('cashConvVal').innerText = convVal.toFixed(2);
                document.getElementById('workCapVal').innerText = `$${((bs[0].totalCurrentAssets - bs[0].totalCurrentLiabilities)/1e9).toFixed(1)}B`;
                document.getElementById('ocfVal').innerText = `$${(cf[0].operatingCashFlow / 1e9).toFixed(1)}B`;
                document.getElementById('fcfVal').innerText = `$${((cf[0].operatingCashFlow - cf[0].capitalExpenditure) / 1e9).toFixed(1)}B`;

                // 3. Diagnostics Map
                document.getElementById('d-oc').innerText = (m[0].operatingCycle || 0).toFixed(1);
                document.getElementById('d-de').innerText = (r[0].debtToEquityRatio || 0).toFixed(2);
                document.getElementById('d-ic').innerText = (r[0].interestCoverageRatio || 0).toFixed(1) + "x";
                document.getElementById('d-fl').innerText = (r[0].financialLeverageRatio || 0).toFixed(2);
                document.getElementById('d-cashr').innerText = (r[0].cashRatio || 0).toFixed(2);
                document.getElementById('d-solv').innerText = (r[0].solvencyRatio || 0).toFixed(2);
                document.getElementById('d-dy').innerText = (r[0].dividendYieldPercentage || 0).toFixed(2) + "%";
                document.getElementById('d-pe').innerText = (r[0].priceToEarningsRatio || 0).toFixed(2) + "x";

                const cr = bs[0].totalCurrentAssets / bs[0].totalCurrentLiabilities;
                const nm = inc[0].netIncome / inc[0].revenue;
                const setBox = (id, val, target, label) => {
                    const el = document.getElementById(id);
                    el.style.background = val >= target ? "#004d26" : "#4d0000";
                    el.innerText = `${label} ${val.toFixed(2)}`;
                };
                setBox('d-cr-box', cr, 1.2, "CR:");
                setBox('d-nm-box', nm, 0.15, "Margin:");
                setBox('d-cc-box', convVal, 1.0, "Conv:");

                // 4. RISK TEXT LOGIC (EXACT REQUEST)
                let riskTxt = "<strong>Standard Profile:</strong> Navigating industry norms.";
                if (cr < 1.0 && nm > 0.15 && convVal > 1.0) {
                    riskTxt = "<strong>Low current ratio, healthy margins & cash conversion:</strong><br>The business is profitable and brings in cash quickly, but it keeps very little cash or short-term assets on hand. This is usually manageable in stable conditions, but it can become risky if sales slow down or unexpected expenses arise.";
                } else if (nm < 0.10 && cr > 1.2 && convVal > 1.0) {
                    riskTxt = "<strong>Low net margin, healthy liquidity & cash conversion:</strong><br>The business handles cash well and can meet short-term obligations, but it earns only a small profit on each sale. This leaves little room for error and increases risk if costs rise or competition forces lower prices.";
                } else if (convVal < 0.7 && nm > 0.15 && cr > 1.2) {
                    riskTxt = "<strong>Poor cash conversion, healthy margin & liquidity:</strong><br>The business reports good profits and appears financially stable, but much of the cash is tied up in receivables or inventory. This means profits may not turn into usable cash quickly, creating funding pressure as the business grows.";
                }
                document.getElementById('verdictText').innerHTML = riskTxt;

                // 5. Visuals
                if (priceChart) priceChart.destroy();
                priceChart = new Chart(document.getElementById('priceChart'), {
                    type: 'line',
                    data: { labels: h.slice(0, 7).reverse().map(d => d.date.substring(5)), datasets: [{ data: h.slice(0, 7).reverse().map(d => d.price), borderColor: themeColor, tension: 0.3 }] },
                    options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
                });

                if (assetChart) assetChart.destroy();
                assetChart = new Chart(document.getElementById('assetChart'), {
                    type: 'doughnut',
                    data: { 
                        labels: ['Cash', 'Inventory', 'Receivables', 'Other'], 
                        datasets: [{ 
                            data: [bs[0].cashAndCashEquivalents, bs[0].inventory, bs[0].netReceivables, (bs[0].totalCurrentAssets - (bs[0].cashAndCashEquivalents + bs[0].inventory + bs[0].netReceivables))],
                            backgroundColor: [themeColor, '#d00000', '#ffb703', '#495057'],
                            borderWidth: 0
                        }] 
                    },
                    options: { maintainAspectRatio: false, cutout: '75%', plugins: { legend: { position: 'right', labels: { color: '#ccc', font: { size: 10 } } } } }
                });

                document.getElementById('mainUI').style.display = 'block';
                switchTab('val');
            } catch (e) { console.error(e); } finally { document.getElementById('loader').style.display = 'none'; }
        }
    </script>
</body>
</html>
